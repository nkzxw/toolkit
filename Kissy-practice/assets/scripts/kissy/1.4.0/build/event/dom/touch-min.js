/*
Copyright 2013, KISSY v1.40
MIT Licensed
build time: Nov 19 23:58
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/single-touch",function(b){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(b){if(b.touches.length!=this.requiredTouchCount)return!1;b=this.lastTouches=b.touches;this.lastXY={pageX:b[0].pageX,pageY:b[0].pageY}},onTouchMove:b.noop,onTouchEnd:b.noop};return c});
KISSY.add("event/dom/touch/tap",function(b,c,d,a){function e(b){b.preventDefault()}function f(){f.superclass.constructor.apply(this,arguments)}var l=d.Object;b.extend(f,a,{onTouchMove:function(b){var a=this.lastXY,b=b.changedTouches[0];if(!b||5<Math.abs(b.pageX-a.pageX)||5<Math.abs(b.pageY-a.pageY))return!1},onTouchEnd:function(a){var f=a.changedTouches[0],a=a.target,j=new l({type:"tap",target:a,currentTarget:a});b.mix(j,{pageX:f.pageX,pageY:f.pageY,which:1,touch:f});d.fire(a,"tap",j);if(j.isDefaultPrevented())d.on(a,
"click",{fn:e,once:1})}});c.tap={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(b,c,d,a){function e(a,b,f){var e=b.changedTouches[0],g=e.pageX-a.startX,p=e.pageY-a.startY,o=Math.abs(g),c=Math.abs(p);if(f){if(a.isVertical&&a.isHorizontal){if(5>Math.max(o,c))return;c>o?a.isHorizontal=0:a.isVertical=0}}else if(a.isVertical&&c<n&&(a.isVertical=0),a.isHorizontal&&o<n)a.isHorizontal=0;if(a.isHorizontal)g=0>g?"left":"right";else if(a.isVertical)g=0>p?"up":"down",o=c;else return!1;d.fire(b.target,f?m:l,{originalEvent:b.originalEvent,pageX:e.pageX,
pageY:e.pageY,which:1,touch:e,direction:g,distance:o,duration:(b.timeStamp-a.startTime)/1E3})}function f(){}var l="swipe",m="swiping",n=50;b.extend(f,a,{onTouchStart:function(a){if(!1===f.superclass.onTouchStart.apply(this,arguments))return!1;var b=a.touches[0];this.startTime=a.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=b.pageX;this.startY=b.pageY;-1!=a.type.indexOf("mouse")&&a.preventDefault()},onTouchMove:function(a){var b=a.changedTouches[0],f=b.pageY-this.startY,b=Math.abs(b.pageX-
this.startX),f=Math.abs(f);if(1E3<a.timeStamp-this.startTime)return!1;this.isVertical&&35<b&&(this.isVertical=0);this.isHorizontal&&35<f&&(this.isHorizontal=0);return e(this,a,1)},onTouchEnd:function(a){return!1===this.onTouchMove(a)?!1:e(this,a,0)}});c[l]=c[m]={handle:new f};return f},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(b,c,d,a){function e(){}b.extend(e,a,{onTouchStart:function(a){if(!1===e.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,e=a.timeStamp,c=a.target,j=a.changedTouches[0],h=e-this.startTime;this.lastEndTime=e;if(b&&(h=e-b,300>h)){this.lastEndTime=0;d.fire(c,"doubleTap",
{touch:j,duration:h/1E3});return}h=e-this.startTime;300<h?d.fire(c,"singleTap",{touch:j,pageX:j.pageX,which:1,pageY:j.pageY,duration:h/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(c,"singleTap",{touch:j,pageX:j.pageX,which:1,pageY:j.pageY,duration:h/1E3})},300)}});c.singleTap=c.doubleTap={handle:new e};return e},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(b,c){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,c=a.touches.length;c===b?this.start():c>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:b.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}"getCommonTarget error!"},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(b,c,d,a){function e(){}function f(a){2==a.touches.length&&a.preventDefault()}b.extend(e,a,{onTouchMove:function(a){if(this.isTracking){var c=a.touches,f,e=c[0],h=c[1];f=e.pageX-h.pageX;e=e.pageY-h.pageY;f=Math.sqrt(f*f+e*e);this.lastTouches=c;this.isStarted?d.fire(this.target,"pinch",b.mix(a,{distance:f,scale:f/this.startDistance})):(this.isStarted=!0,this.startDistance=f,c=this.target=this.getCommonTarget(a),d.fire(c,"pinchStart",b.mix(a,{distance:f,scale:1})))}},
fireEnd:function(a){d.fire(this.target,"pinchEnd",b.mix(a,{touches:this.lastTouches}))}});a=new e;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,add:function(){d.on(this,"touchmove",f)},remove:function(){d.detach(this,"touchmove",f)}};return e},{requires:["./handle-map","event/dom/base","./multi-touch"]});
KISSY.add("event/dom/touch/tap-hold",function(b,c,d,a){function e(){}b.extend(e,d,{onTouchStart:function(c){if(!1===e.superclass.onTouchStart.call(this,c))return!1;this.timer=setTimeout(function(){var e=c.touches[0];a.fire(c.target,"tapHold",{touch:e,pageX:e.pageX,pageY:e.pageY,which:1,duration:(b.now()-c.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});c.tapHold={handle:new e};return e},{requires:["./handle-map","./single-touch",
"event/dom/base"]});
KISSY.add("event/dom/touch/rotate",function(b,c,d,a,e){function f(){}function l(a){2==a.touches.length&&a.preventDefault()}var m=180/Math.PI;b.extend(f,d,{onTouchMove:function(c){if(this.isTracking){var f=c.touches,d=f[0],i=f[1],k=this.lastAngle,d=Math.atan2(i.pageY-d.pageY,i.pageX-d.pageX)*m;if(k!==e){var i=Math.abs(d-k),g=(d+360)%360,p=(d-360)%360;Math.abs(g-k)<i?d=g:Math.abs(p-k)<i&&(d=p)}this.lastTouches=f;this.lastAngle=d;this.isStarted?a.fire(this.target,"rotate",b.mix(c,{angle:d,rotation:d-
this.startAngle})):(this.isStarted=!0,this.startAngle=d,this.target=this.getCommonTarget(c),a.fire(this.target,"rotateStart",b.mix(c,{angle:d,rotation:0})))}},end:function(){this.lastAngle=e;f.superclass.end.apply(this,arguments)},fireEnd:function(c){a.fire(this.target,"rotateEnd",b.mix(c,{touches:this.lastTouches}))}});d=new f;c.rotateEnd=c.rotateStart={handle:d};c.rotate={handle:d,add:function(){a.on(this,"touchmove",l)},remove:function(){a.detach(this,"touchmove",l)}};return f},{requires:["./handle-map",
"./multi-touch","event/dom/base"]});
KISSY.add("event/dom/touch/handle",function(b,c,d,a){function e(g){return b.startsWith(g,"touch")}function f(g){return b.startsWith(g,"mouse")}function l(g){return b.startsWith(g,"MSPointer")}function m(g){this.doc=g;this.eventHandle={};this.init();this.touches=[];this.inTouch=0}var n=b.guid("touch-handle"),j=b.Features,h,i,k;j.isTouchEventSupported()?b.UA.ios?(k="touchend touchcancel",h="touchstart",i="touchmove"):(k="touchend touchcancel mouseup",h="touchstart mousedown",i="touchmove mousemove"):
j.isMsPointerSupported()?(h="MSPointerDown",i="MSPointerMove",k="MSPointerUp MSPointerCancel"):(h="mousedown",i="mousemove",k="mouseup");m.prototype={constructor:m,lastTouches:[],firstTouch:null,init:function(){var g=this.doc;a.on(g,h,this.onTouchStart,this);if(!l(i))a.on(g,i,this.onTouchMove,this);a.on(g,k,this.onTouchEnd,this)},addTouch:function(g){g.identifier=g.pointerId;this.touches.push(g)},removeTouch:function(g){for(var a=0,b=g.pointerId,c=this.touches,d=c.length;a<d;a++){g=c[a];if(g.pointerId===
b){c.splice(a,1);break}}},updateTouch:function(g){for(var a=0,b,c=g.pointerId,d=this.touches,e=d.length;a<e;a++){b=d[a];b.pointerId===c&&(d[a]=g)}},isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(this.firstTouch===null)this.firstTouch=a.identifier},removePrimaryTouch:function(a){if(this.isPrimaryTouch(a))this.firstTouch=null},dupMouse:function(a){var b=this.lastTouches,a=a.changedTouches[0];if(this.isPrimaryTouch(a)){var c={x:a.clientX,y:a.clientY};
b.push(c);setTimeout(function(){var a=b.indexOf(c);a>-1&&b.splice(a,1)},2500)}},isEventSimulatedFromTouch:function(a){for(var b=this.lastTouches,c=a.clientX,a=a.clientY,d=0,e=b.length,f;d<e&&(f=b[d]);d++){var i=Math.abs(c-f.x),h=Math.abs(a-f.y);if(i<=25&&h<=25)return true}return 0},normalize:function(a){var b=a.type,c;if(e(b)){c=b=="touchend"||b=="touchcancel"?a.changedTouches:a.touches;if(c.length==1){a.which=1;a.pageX=c[0].pageX;a.pageY=c[0].pageY}return a}c=this.touches;b=!b.match(/(up|cancel)$/i);
a.touches=b?c:[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchStart:function(b){var c,d;d=b.type;var h=this.eventHandle;if(e(d)){this.setPrimaryTouch(b.changedTouches[0]);this.dupMouse(b)}else if(f(d)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[b.originalEvent]}else if(l(d)){this.addTouch(b.originalEvent);if(this.touches.length==1)a.on(this.doc,i,this.onTouchMove,this)}else throw Error("unrecognized touch event: "+b.type);for(c in h){d=h[c].handle;d.isActive=1}this.callEventHandle("onTouchStart",
b)},onTouchMove:function(a){var b=a.type;if(!e(b))if(f(b)){if(this.isEventSimulatedFromTouch(b))return;this.touches=[a.originalEvent]}else if(l(b))this.updateTouch(a.originalEvent);else throw Error("unrecognized touch event: "+a.type);this.callEventHandle("onTouchMove",a)},onTouchEnd:function(c){var d=this,o=c.type;if(!f(o)||!d.isEventSimulatedFromTouch(c)){d.callEventHandle("onTouchEnd",c);if(e(o)){d.dupMouse(c);b.makeArray(c.changedTouches).forEach(function(a){d.removePrimaryTouch(a)})}else if(f(o))d.touches=
[];else if(l(o)){d.removeTouch(c.originalEvent);d.touches.length||a.detach(d.doc,i,d.onTouchMove,d)}}},callEventHandle:function(a,b){var c=this.eventHandle,d,e,b=this.normalize(b);for(d in c){e=c[d].handle;if(!e.processed){e.processed=1;if(e.isActive&&e[a]&&e[a](b)===false)e.isActive=0}}for(d in c){e=c[d].handle;e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;if(b[a]){b[a].count--;
b[a].count||delete b[a]}},destroy:function(){var b=this.doc;a.detach(b,h,this.onTouchStart,this);a.detach(b,i,this.onTouchMove,this);a.detach(b,k,this.onTouchEnd,this)}};return{addDocumentHandle:function(a,b){var d=c.getDocument(a),e=c.data(d,n);e||c.data(d,n,e=new m(d));b&&e.addEventHandle(b)},removeDocumentHandle:function(a,d){var e=c.getDocument(a),f=c.data(e,n);if(f){d&&f.removeEventHandle(d);if(b.isEmptyObject(f.eventHandle)){f.destroy();c.removeData(e,n)}}}}},{requires:"dom,./handle-map,event/dom/base,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate".split(",")});
KISSY.add("event/dom/touch",function(b,c,d,a){function e(b){a.addDocumentHandle(this,b);d[b].setup.apply(this,arguments)}function f(b){a.removeDocumentHandle(this,b);d[b].tearDown.apply(this,arguments)}function l(b){a.addDocumentHandle(this,b)}function m(b){a.removeDocumentHandle(this,b)}var b=c.Gesture,n=b.start="KSPointerDown",j=b.move="KSPointerMove",h=b.end="KSPointerUp";b.tap="tap";b.doubleTap="doubleTap";d[n]={handle:{isActive:1,onTouchStart:function(a){c.fire(a.target,n,a)}}};d[j]={setup:function(){var a=
this.ownerDocument||this;a.__ks__pointer_events_count=a.__ks__pointer_events_count||0;a.__ks__pointer_events_count++},tearDown:function(){var a=this.ownerDocument||this;a.__ks__pointer_events_count&&a.__ks__pointer_events_count--},handle:{isActive:1,onTouchMove:function(a){var b=a.target;(b.ownerDocument||b).__ks__pointer_events_count&&c.fire(b,j,a)}}};d[h]={handle:{isActive:1,onTouchEnd:function(a){c.fire(a.target,h,a)}}};var b=c.Special,i,k,g;for(k in d)i={},g=d[k],i.setup=g.setup?e:l,i.tearDown=
g.tearDown?f:m,g.add&&(i.add=g.add),g.remove&&(i.remove=g.remove),b[k]=i},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
